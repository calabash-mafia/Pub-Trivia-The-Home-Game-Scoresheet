<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Pub Trivia: The Home Game</title>
    <meta name="description" content="Scoresheet for Pub Trivia: The Home Game">
    <meta name="author" content="Josh Hurd">
    <link rel="stylesheet" href="./css/bootstrap.min.css" media="screen">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js" integrity="sha512-kp7YHLxuJDJcOzStgd6vtpxr4ZU9kjn77e6dBsivSz+pUuAuMlE2UTdKB7jjsWT84qbS8kdCWHPETnP/ctrFsA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.14.0/umd/react.development.min.js" integrity="sha512-UPkpLmqtdoGMgoSu5NPNmCNlSJgoo5TzWgmNIlxrkAnzFLagJFSq/TXhRONbh3stAELV1L8aW51kHgO590hoPg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.14.0/umd/react-dom.development.min.js" integrity="sha512-MR3vAYS2MtxprEhppuIbmW8QISydo1GkSniCsCoN0qUaBGb2h9qLmZY0N8WImkRAGaSRDeqLM2/bkCUpPYxPZg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/7.5.1/math.min.js" integrity="sha512-6SHRAV8GhJ+3WvGPKQNsBpLj7J9QF9JFwH7nPSRLtH/OqFrlXRd54Z+QDgw7xj1f7dV8c50sKhZYr/xGPlMoiw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.slim.min.js" integrity="sha512-/DXTXr6nQodMUiq+IUJYCt2PPOUjrHJ9wFrqpJ3XkgPNOZVfMok7cRw6CSxyCQxXn6ozlESsSh1/sMCTF1rL/g==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js" integrity="sha512-iceXjjbmB2rwoX93Ka6HAHP+B76IY1z0o3h+N1PeDtRSsyeetU3/0QKJqGyPJcX63zysNehggFwMC/bi7dvMig==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js" integrity="sha512-k8F8QynmFNURwbUJC8drKA+fo3YfNvjqKzStdydD6au+MzvxBoRnxH8E31RJXwDY9DrnEiPhh9wBoDSIxhkyHQ==" crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Pacifico&display=swap" rel="stylesheet">

    <style>
        /* Color palette:
        Maroon:  #800000
        Dark grey:  #767676
        Light grey: : #D6D6CE
        Yellow:  #FFA319
        Orange: #C16622
        Red:  #8F3931
        Light green:  #8A9045
        Dark green: #58593F
        Blue: #155F83
        Violet:  #350E20 */

        /* Holiday colors
        Light green: #0CB04A
        Dark green: #0A7533
        Light red: #FF3A2F
        Dark red: #A92921
        */

        body {
            color: #800000;
            background-color: rgb(214 214 206 / 50%);
            font-family: 'Pacifico', cursive;
        }

        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
            font-family: 'Pacifico', cursive;
            font-weight: 700;
        }

        button, input, optgroup, select, textarea, #footer, #final-results .btn {
            font-family: 'VT323', monospace;
        }

        .btn-primary {
            background-color: #155F83;
            border-color: #155F83;
        }
        .btn-primary:hover, .btn-primary:not(:disabled):not(.disabled):active {
            background-color: #5B8FA8;
            border-color: #0F425C;
        }
        .text-muted {
            color: #767676;
        }
        .alert.alert-warning {
            background-color: #FFB547;
            color: #58593F;
            border-color: #58593F;
        }
        .alert-dismissible.alert-warning, .alert-dismissible.alert-warning .alert-link, .alert-dismissible.alert-warning .close:before {
            color: #58593F;
        }
        .btn.btn-danger {
            background-color: #8F3931;
            border-color: #8F3931;
        }
        .btn.btn-danger:hover, .btn-danger:not(:disabled):not(.disabled):active {
            background-color: #642822;
            border-color: #642822;
        }
        .form-control {
            border-color: #767676;
        }
        .form-control:focus {
            box-shadow: 0 0 0 0.2rem rgb(255 163 25 / .5);
            border-color: #FFA319;
        }
        #final-results {
            border-color: #155F83;
            border-width: 4px;
            background-color: rgb(21 95 131 / .05);
        }
        #final-results h1 {
            color: #155F83;
        }
        #final-results ul, #final-results ol {
            font-size: 1.25em;
            color: #333;
        }
        #final-results p {
            color: #333;
        }

        /* https://developer.mozilla.org/en-US/docs/Web/HTML/Element/blink */
        blink {
            animation: 1s linear infinite condemned_blink_effect;
        }
        @keyframes condemned_blink_effect {
            0% {
                visibility: hidden;
            }
            50% {
                visibility: hidden;
            }
            100% {
                visibility: visible;
            }
        }

        #footer {
            /* margin-top: 100px; */
            background-color: #767676;
            padding: 40px 0px;
            color: #fff;
        }
        #footer a {
            color: #D6D6CE;
        }


        #treelayer {
            margin-top: 40px;
            background-image: url(jean_victor_balin_sapin_02_xmas_bw.svg);
            background-position: bottom;
            background-repeat: repeat-x;
            padding-bottom: 100px;
        }

        table {
            font-size: 1.4em;
        }
        table th, table td {
            background-color: transparent;
        }
        table thead {
            background-color: #8A9045;
            color: #fff;
        }
        .table th, .table td {
            border-top: none;
        }

    </style>
</head>

<body>
    <div class="container">
        <!-- <div class="alert alert-dismissible alert-warning mt-5">
            <button type="button" class="close" data-dismiss="alert">√ó</button>
            <h2>Welcome to the online scoresheet!</h2>
            <p><strong>Aren't you lucky!</strong> Now you can receive the joys of being a scorekeeper too! Here is how to use this online app scoresheet thingy:</p>
            <p>
                <ol>
                    <li>Use Chrome as your browser, if you can. It makes things prettier :-)</li>
                    <li>asdf</li>
                    <li>asdf</li>
                </ol>
            </p>
        </div> -->
        <div id="trivia_scoresheet"></div>
    </div>
    
    
    <div id="treelayer">&nbsp;</div>
    <div id="footer">
        <div class="container">
            <div>How was this made? <a href="https://pages.github.com/">GitHub Pages</a>, <a href="https://reactjs.org/">React</a>, <a href="https://getbootstrap.com/">Bootstrap</a>, <a href="https://bootswatch.com/sketchy/">Bootswatch Sketchy</a>, and a bunch of Javascript.</div>
        </div>
    </div>
    <script type="text/babel">

        const RANDOM_TEAM_NAMES = ["Wide maintenance", "Jagged assistant", "Stale performance", "Loud history", "Thin confusion", "Learned database", "Good hospital", "Plain employee", "Fixed conclusion", "Glib magazine", "Wry inflation", "Best foundation", "Free director", "Two solution", "Grey cabinet", "Cute studio", "Cheap medicine", "Slim agency", "Wrong difference", "Far profession", "Drab article", "Ten cigarette", "Drunk equipment", "Eight tradition", "Old intention", "Pink assistance", "Quick charity", "Small video", "Green reaction", "Tan energy"];
        const NORMAL_TEAMS = ["Pierre Burreaux", "BoJo does...", "Revenge of the...", "Team Suki", "Fetarogie and ...", "The Canucks...", "Krullin'...", "Bitsy and Fianc√©", "Team Aimee +1", "Josh and Forewing"];
        const NUM_ROUNDS = 4;
        const QM_DISPLAY_CHAR = 'üëë';

        // https://stackoverflow.com/a/58325961
        function genHexId() {
            var len = 8;
            const hex = '0123456789ABCDEF';
            let output = '';
            for (let i = 0; i < len; ++i) {
                output += hex.charAt(Math.floor(Math.random() * hex.length));
            }
            return output;
        }

        // https://stackoverflow.com/a/44071316
        const shuffleArray = (array) => {
            let currentIndex = array.length;
            let temporaryValue;
            let randomIndex;
            const newArray = array.slice();
            // While there remains elements to shuffle...
            while (currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                // Swap it with the current element.
                temporaryValue = newArray[currentIndex];
                newArray[currentIndex] = newArray[randomIndex];
                newArray[randomIndex] = temporaryValue;
            }
            return newArray;
        };

        function SortByKey(array, key) {
            return array.sort(function(a, b) {
                var x = a[key]; var y = b[key];
                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
            });
        }

        function TeamRoundScoreDropdown(props) {
            return (
                <select className="form-control form-control-lg" value={props.score} onChange={props.handleTeamScoreChange}>
                    <option></option>
                    <option>0</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option value="QM">{QM_DISPLAY_CHAR}</option>
                </select>
            )
        }

        class TriviaScoresheet extends React.Component {
            
            constructor(props) {
                super(props);
                // Retrieve the object from storage
                var retrievedTeamsStr = localStorage.getItem(`trivia_${this.getTodayStr()}`);
                var initialTeams = JSON.parse(retrievedTeamsStr);
                if (initialTeams == null) {
                    initialTeams = shuffleArray(NORMAL_TEAMS).map(n => {
                        return {
                            id: genHexId(),
                            name: n,
                            round1: '',
                            round2: '',
                            round3: '',
                            round4: ''
                        }
                    })
                }
                // Set the state
                this.state = {
                    hasGameStarted: false,
                    teams: initialTeams,
                    calculatedScores: null,
                };
                this.handleAddTeam = this.handleAddTeam.bind(this);
                this.handleRemoveTeam = this.handleRemoveTeam.bind(this);
                this.handleTeamNameChange = this.handleTeamNameChange.bind(this);
                this.handleTeamScoreChange = this.handleTeamScoreChange.bind(this);
                this.getAllTeamRows = this.getAllTeamRows.bind(this);
                this.getQMAdjust = this.getQMAdjust.bind(this);
                this.handleTallyRound = this.handleTallyRound.bind(this);
                this.getCurrentRoundNum = this.getCurrentRoundNum.bind(this);
                this.handleSaveScoresheetToCSV = this.handleSaveScoresheetToCSV.bind(this);
                this.handleSaveScoresheetToJSON = this.handleSaveScoresheetToJSON.bind(this);
                
            }

            handleAddTeam() {
                var newTeams = this.state.teams;
                newTeams.push({
                    id: genHexId(),
                    name: RANDOM_TEAM_NAMES[Math.floor(Math.random()*RANDOM_TEAM_NAMES.length)],
                    round1: '', round2: '', round3: '', round4: '',
                });
                this.setState({teams: newTeams});
            }

            handleRemoveTeam(teamIdToRemove) {
                var newTeams = this.state.teams.filter(t => t.id != teamIdToRemove);
                this.setState({teams: newTeams});
            }

            handleTeamNameChange(teamIndex, e) {
                var newTeams = this.state.teams;
                newTeams[teamIndex].name = e.target.value;
                this.setState({teams: newTeams});
            }

            handleTeamScoreChange(roundNum, teamIndex, e) {
                var newTeams = this.state.teams;
                newTeams[teamIndex][roundNum] = e.target.value;
                this.setState({
                    teams: newTeams,
                    hasGameStarted: true
                });
            }

            getTodayStr() {
                var today = new Date(Date.now());
                return today.toDateString();
            }
            
            getAllTeamRows() {
                var teamRows = this.state.teams.map(t => {
                    return [t.name, t.round1, t.round2, t.round3, t.round4];
                })
                return teamRows;
            }

            getCurrentRoundNum() {
                for (let rnd = 1; rnd <= NUM_ROUNDS; rnd++) {
                    if (this.state.teams[0][`round${rnd}`] === "") {
                        return rnd - 1;
                    }
                }
                return -1;
            }

            getQMAdjust(qmTeamRow) {
                // Get QuizMaster round
                var qmRoundIdx = null;
                for (let i = 1; i <= NUM_ROUNDS + 1; i++) {
                    if (qmTeamRow[i] === "QM") {
                    qmRoundIdx = i;
                    }
                }
                // Return if team wasn't a QM for a round
                if (qmRoundIdx === null) {
                    return null;
                }
                // Get all the team rwos
                var allTeamRows = this.getAllTeamRows();
                // Get the other team scores for the round team was QM
                var qmRoundScores = allTeamRows.filter(t => t[qmRoundIdx] != "QM").map(t => t[qmRoundIdx]);
                // Get the current round
                var currentRound = this.getCurrentRoundNum();
                // If this is the first round, then return the median score for the round
                if (currentRound == 1) {
                    return {'score': Math.ceil(math.median(qmRoundScores)), 'teams': ['[Round median]']};
                }
                // Finally, calculate the mean square errors between the QM team and other teams
                console.log("QM Adjust:", qmTeamRow);
                var teamMSEValues = allTeamRows.filter(tr => tr[0] != qmTeamRow[0]).map(tr => {
                    var teamSquareErrors = [];
                    // Loop through the rounds
                    for (let roundNum = 1; roundNum <= NUM_ROUNDS; roundNum++) {
                        if (roundNum != qmRoundIdx && tr[roundNum] != "QM" && tr[roundNum] != "") {
                            var scoreDiffSquared = (qmTeamRow[roundNum] - tr[roundNum]) ** 2;
                            teamSquareErrors.push(scoreDiffSquared);
                        }
                    }
                    // If we don't have square of score diffs to average, then skip this team
                    // This could happen in Round 2, when each team has been QM.
                    if (teamSquareErrors.length === 0) {
                        return null;
                    }
                    // Add the MSE and team to the list of tuples
                    var mse = math.mean(teamSquareErrors);
                    console.log("  -", mse, tr[0]);
                    return {'team': tr[0], 'mse': mse, 'score': tr[qmRoundIdx]};
                }).filter(msev => msev != null);
                // Sort the scores
                teamMSEValues = SortByKey(teamMSEValues, 'mse');
                // Loop through the teams
                // Get the final MSE lookout info
                var mseTeamNames = teamMSEValues.filter(item => item.mse == teamMSEValues[0].mse).map(item => item.team);
                var bestMSEScore = Math.max(...teamMSEValues.filter(item => item.mse == teamMSEValues[0].mse).map(item => item.score));
                console.log("Lookalike:", bestMSEScore, mseTeamNames);
                return {'score': bestMSEScore, 'teams': mseTeamNames};
            }

            handleTallyRound() {
                console.log('handleTallyRound');
                // Calculate the scores
                var calculatedScores = this.state.teams.map(t => {
                    // Initialize the team score dict
                    var teamCalcScore = {
                        id: t.id,
                        name: t.name,
                        total: 0
                    }
                    // Get the QM adjustment
                    var tr = [t.name, t.round1, t.round2, t.round3, t.round4];
                    var teamQMAdjust = this.getQMAdjust(tr);
                    // Process each round
                    for (let rnd = 1; rnd <= NUM_ROUNDS; rnd++) {
                        var roundName = `round${rnd}`;
                        // Add to the total
                        var roundInt = parseInt(t[roundName]);
                        var roundScoreLabel = t[roundName];
                        var roundScoreStr = t[roundName];
                        if (!isNaN(roundInt)) {
                            teamCalcScore.total = teamCalcScore.total + roundInt;
                        }
                        // Integrate the QM data
                        if (t[roundName] == 'QM') {
                            teamCalcScore.total = teamCalcScore.total + parseInt(teamQMAdjust.score);
                            roundScoreLabel = <span>{teamQMAdjust.score}&nbsp;<sup>{QM_DISPLAY_CHAR}</sup></span>;
                            roundScoreStr = `${teamQMAdjust.score} (QM)`
                            teamCalcScore.lookalikeTeams = teamQMAdjust.teams.join('; ');
                        }
                        // Add the round value
                        teamCalcScore[`round${rnd}ScoreLabel`] = roundScoreLabel;
                        teamCalcScore[`round${rnd}ScoreStr`] = roundScoreStr;
                    }
                    return teamCalcScore;
                })
                // Sort the scores
                calculatedScores = SortByKey(calculatedScores, 'total').reverse();
                // Shuffle the team score table
                var shuffledTeams = shuffleArray(this.state.teams)
                // Update the state
                this.setState({
                    calculatedScores: calculatedScores,
                    teams: shuffledTeams
                });
                // Put the object into storage
                localStorage.setItem(`trivia_${this.getTodayStr()}`, JSON.stringify(shuffledTeams));
            }

            handleSaveScoresheetToCSV() {
                var rows = this.state.calculatedScores.map(cs => {
                    var lookalikeTeamsStr = cs.lookalikeTeams || "";
                    return [`"${cs.name}"`, cs.round1ScoreStr, cs.round2ScoreStr, cs.round3ScoreStr, cs.round4ScoreStr, cs.total, `"${lookalikeTeamsStr}"`];
                })
                let csvContent = "Team,Round 1,Round 2,Round 3,Round 4,Total,QM Lookalikes\r\n";
                rows.forEach(function(rowArray) {
                    let row = rowArray.join(",");
                    csvContent += row + "\r\n";
                });
                var blob = new Blob([csvContent], {type: "text/csv;charset=utf-8"});
                saveAs(blob, `Trivia Scoresheet ${this.getTodayStr()}.csv`);
            }

            handleSaveScoresheetToJSON() {
                const jsonContent = JSON.stringify({
                    teams: this.state.teams,
                    calculatedScores: this.state.calculatedScores
                });
                var blob = new Blob([jsonContent], {type: "text/json;charset=utf-8"});
                saveAs(blob, `Trivia Scoresheet ${this.getTodayStr()}.json`);
            }

            render() {
                var today = new Date(Date.now());

                var teamRows = this.state.teams.map((t, i) => {
                    var removeTeamButtonCol = null;
                    if (this.state.hasGameStarted === false) {
                        removeTeamButtonCol = (
                            <div className="col">
                                <button type="button" title={`Remove '${t.name}' from the scoresheet`} onClick={this.handleRemoveTeam.bind(null, t.id)} className="btn btn-danger">‚úñ</button>
                            </div>
                        )
                    }
                    return (
                        <div key={t.id} className="row mt-2">
                            <div className="col-5">
                                <input type="text" onChange={this.handleTeamNameChange.bind(null, i)} className="form-control form-control-lg" value={t.name} />
                            </div>
                            <div className="col">
                                <TeamRoundScoreDropdown score={t.round1} handleTeamScoreChange={this.handleTeamScoreChange.bind(null, "round1", i)} />
                            </div>
                            <div className="col">
                                <TeamRoundScoreDropdown score={t.round2} handleTeamScoreChange={this.handleTeamScoreChange.bind(null, "round2", i)} />
                            </div>
                            <div className="col">
                                <TeamRoundScoreDropdown score={t.round3} handleTeamScoreChange={this.handleTeamScoreChange.bind(null, "round3", i)} />
                            </div>
                            <div className="col">
                                <TeamRoundScoreDropdown score={t.round4} handleTeamScoreChange={this.handleTeamScoreChange.bind(null, "round4", i)} />
                            </div>
                            {removeTeamButtonCol}
                        </div>
                    )
                })
                // Team adding / removing
                var addTeamButton = null;
                var removeTeamButtonColHeader = null;
                if (this.state.hasGameStarted === false) {
                    addTeamButton = <button type="button" onClick={this.handleAddTeam} className="btn btn-sm btn-outline-dark mt-2" title="Add team">Ôºã Add team</button>;
                    removeTeamButtonColHeader = <div className="col">&nbsp;</div>;
                }
                // Ranking table
                var rankingTableEl = null;
                if (this.state.calculatedScores !== null) {
                    var tableRows = this.state.calculatedScores.map((cs, i) => {
                        return (
                            <tr key={cs.id}>
                                <th scope="row">{cs.name}</th>
                                <td>{cs.round1ScoreLabel}</td>
                                <td>{cs.round2ScoreLabel}</td>
                                <td>{cs.round3ScoreLabel}</td>
                                <td>{cs.round4ScoreLabel}</td>
                                <td>{cs.total}</td>
                                <td>{cs.lookalikeTeams}</td>
                            </tr>
                        )
                    })
                    rankingTableEl = (
                        <div className="mb-5">
                            <h2 className="mt-5">Ranking table</h2>
                            <table className="table">
                                <thead>
                                    <tr>
                                    <th scope="col">Team</th>
                                    <th scope="col">Round 1</th>
                                    <th scope="col">Round 2</th>
                                    <th scope="col">Round 3</th>
                                    <th scope="col">Round 4</th>
                                    <th scope="col">Total</th>
                                    <th scope="col">QM Lookalike</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {tableRows}
                                </tbody>
                            </table>
                        </div>
                    )
                }
                // Final results info
                var finalResultsEl = null;
                if (this.state.calculatedScores != null && this.state.calculatedScores[0].round4ScoreLabel != '') {
                    // Get the sorted ranked scores
                    var scoreValues = [...new Set(this.state.calculatedScores.map(cs => cs.total))]; 
                    var firstPlaceScore = scoreValues[0];
                    var secondPlaceScore = scoreValues[1];
                    var lastPlaceScore = scoreValues[scoreValues.length - 1];
                    // Determine winner
                    var winningTeamsEls = this.state.calculatedScores.filter(cs => cs.total == firstPlaceScore).map(cs => <li key={cs.id}>{cs.name}</li>);
                    var winningTeamsTieStr = null;
                    if (winningTeamsEls.length > 1) {
                        winningTeamsTieStr = "s (TIE!)"
                    }
                    // Determine second place
                    // var secondTeamsEls = this.state.calculatedScores.filter(cs => cs.total == secondPlaceScore).map(cs => <li key={cs.id}>{cs.name}</li>);
                    // var secondTeamsTieStr = null;
                    // if (secondTeamsEls.length > 1) {
                    //     secondTeamsTieStr = " (TIE!)"
                    // }
                    // Determine last place
                    var lastTeamsEls = this.state.calculatedScores.filter(cs => cs.total == lastPlaceScore).map(cs => <li key={cs.id}>{cs.name}</li>);
                    var lastTeamsTieStr = null;
                    if (lastTeamsEls.length > 1) {
                        lastTeamsTieStr = " (TIE!)"
                    }
                    // Random QMs for next week
                    var randomOtherTeamsEls = shuffleArray(this.state.calculatedScores).filter(cs => {
                        // return cs.total != firstPlaceScore && cs.total != secondPlaceScore && cs.total != lastPlaceScore;
                        return cs.total != firstPlaceScore && cs.total != lastPlaceScore;
                    }).map(cs => <li key={cs.id}>{cs.name}</li>);
                    if (randomOtherTeamsEls.length == 0) {
                        randomOtherTeamsEls = [
                            <li key='whack1'>ü§Øü§Øü§Ø</li>,
                            <li key='whack2'>ALL TEAMS FIRST OR LAST PLACE!?!?!?</li>,
                            <li key='whack3'>ü§Øü§Øü§Ø</li>
                        ];
                    }
                    // Output the results
                    finalResultsEl = (
                        <div id="final-results" className="jumbotron mt-5">
                            <h1 className="display-3">Final results</h1>
                            <div className="row">
                                <div className="col-sm-4">
                                    <h3>Winner{winningTeamsTieStr}</h3>
                                    <ul>
                                        {winningTeamsEls}
                                    </ul>
                                </div>
                                <div className="col-sm-4">
                                    <h3>Last place{lastTeamsTieStr}</h3>
                                    <ul>
                                        {lastTeamsEls}
                                    </ul>
                                </div>
                                <div className="col-sm-4">
                                    <h3>Everybody else</h3>
                                    <ol style={{listStyle: 'lower-alpha'}}>
                                        {randomOtherTeamsEls}
                                    </ol>
                                    <p>(randomized for easy picking of next week's quizmasters)</p>
                                </div>                                
                            </div>
                            <div className="text-center mt-5">
                                <button className="btn btn-sm btn-outline-secondary mr-1" onClick={this.handleSaveScoresheetToCSV}><span className="mr-2">üíæ</span>Save scoresheet to CSV</button>
                                <button className="btn btn-sm btn-outline-secondary ml-1" onClick={this.handleSaveScoresheetToJSON}><span className="mr-2">üíæ</span>Save scoresheet to JSON</button>
                            </div>
                        </div>
                    )
                    
                }
                
                var buttonStr = 'Tally up scores for round and whatnot';
                return (
                    <div>
                        <h1 className="mt-5 mb-0">Pub Trivia: The Home Game üçª</h1>
                        <p className="text-muted">For {this.getTodayStr()}</p>
                        <h2>Scoresheet</h2>
                        <div className="row mt-2">
                            <div className="col-5">
                                <strong>Team name</strong>
                            </div>
                            <div className="col">
                                <strong>Round 1</strong>
                            </div>
                            <div className="col">
                                <strong>Round 2</strong>
                            </div>
                            <div className="col">
                                <strong>Round 3</strong>
                            </div>
                            <div className="col">
                                <strong>Round 4</strong>
                            </div>
                            {removeTeamButtonColHeader}
                        </div>
                        {teamRows}
                        {addTeamButton}
                        <div className="text-center">
                            <button type="button" className="btn btn-primary btn-lg mt-4" onClick={this.handleTallyRound} title="Tally up scores for round and whatnot">{buttonStr}</button>
                            
                        </div>
                        {rankingTableEl}
                        {finalResultsEl}
                    </div>
                );
            }
        }

        const domContainer = document.querySelector('#trivia_scoresheet');
        ReactDOM.render(React.createElement(TriviaScoresheet), domContainer);

    </script>

</body>
</html>
